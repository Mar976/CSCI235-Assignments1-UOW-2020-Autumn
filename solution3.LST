SQL> SET FEEDBACK ON
SQL> SET LINESIZE 300
SQL> SET PAGESIZE 200
SQL> SET SERVEROUTPUT ON
SQL> 
SQL> CREATE OR REPLACE PROCEDURE INSERT_ORDER_DETAIL(INPUT_ORDER_ID NUMBER, INPUT_PRODUCT_NAME VARCHAR, INPUT_PRICE NUMBER, INPUT_QUANTITY NUMBER, INPUT_DISCOUNT NUMBER)
  2  IS 
  3      TEST_DISCONTINUED PRODUCT.DISCONTINUED%TYPE;
  4  BEGIN
  5      SELECT DISCONTINUED INTO TEST_DISCONTINUED
  6      FROM PRODUCT
  7      WHERE PRODUCT_NAME = INPUT_PRODUCT_NAME;
  8      --CHECKING IF THE PRODUCT IS NTO DISCONTINUED
  9      IF(TEST_DISCONTINUED != 'N') THEN
 10          DBMS_OUTPUT.PUT_LINE('ROW INSERT FAILED: THE PRODUCT IS DISCONTINUED!');
 11      ELSE
 12          INSERT INTO ORDER_DETAIL VALUES(INPUT_ORDER_ID, INPUT_PRODUCT_NAME, INPUT_PRICE, INPUT_QUANTITY, INPUT_DISCOUNT);
 13          DBMS_OUTPUT.PUT_LINE('ROW INSERT SUCCESSFUL');
 14      END IF;  
 15  EXCEPTION
 16      WHEN NO_DATA_FOUND THEN
 17          DBMS_OUTPUT.PUT_LINE('DATA NOT FOUND!');
 18      WHEN OTHERS THEN
 19          DBMS_OUTPUT.PUT_LINE(SQLERRM);
 20      COMMIT;
 21  END INSERT_ORDER_DETAIL;
 22  /

Procedure INSERT_ORDER_DETAIL compiled

SQL> 
SQL> --PRODUCT DISC: N
SQL> EXECUTE INSERT_ORDER_DETAIL(248, 'Aniseed Syrup', 8, 30, 0);
ORA-00001: unique constraint (MAR976.PK_ORDER_DETAIL) violated


PL/SQL procedure successfully completed.

SQL> --PRODUCT DISC: Y
SQL> EXECUTE INSERT_ORDER_DETAIL(253,'Chef Anton''s Gumbo Mix', 50, 30, 0);
ROW INSERT FAILED: THE PRODUCT IS DISCONTINUED!


PL/SQL procedure successfully completed.

SQL> 
SQL> SPOOL OFF
